(this["webpackJsonpviatick-test"]=this["webpackJsonpviatick-test"]||[]).push([[0],{111:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n(2),c=n.n(i),r=n(15),s=n.n(r),d=(n(62),n(23)),o=n(14),l=n(24),u=n(25),j=n(28),p=n(27),h=n(121),v=n(120),b=n(124),O=n(122),g=n(123),m=n(113);function x(e){return e.loading?Object(a.jsx)("div",{className:"loading-container",children:Object(a.jsx)("div",{className:"loading-div",children:Object(a.jsx)(m.a,{style:{width:"3rem",height:"3rem"}})})}):null}var f=n(12),S=n.n(f),D=n(18),_=n(17),I=n.n(_),y=n(32),E=n.n(y),T={API_KEY:Object({NODE_ENV:"production",PUBLIC_URL:"/viatick-test",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).API_KEY||"7c62db1cfb47550927b11191b7995f6cd482b7481fd0d98f1d8b403937b909f9",API_URL:Object({NODE_ENV:"production",PUBLIC_URL:"/viatick-test",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).API_URL||"https://aitjmbzhsbagnbysj2jrinbrsq.appsync-api.ap-northeast-1.amazonaws.com/graphql",TOKEN_URL:Object({NODE_ENV:"production",PUBLIC_URL:"/viatick-test",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).TOKEN_URL||"https://bms-api.viatick.com/main/api/oauth2/token",X_API_KEY:Object({NODE_ENV:"production",PUBLIC_URL:"/viatick-test",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).X_API_KEY||"da2-zlk3xmy44fg4jpj73vlwlfi7sq"},k=T.API_KEY,C=T.API_URL,U=T.TOKEN_URL,R=T.X_API_KEY,w=function(){var e=Object(D.a)(S.a.mark((function e(){var t,n,a,i;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Date.now(),e.next=4,E.a.post(U,{},{headers:{grant_type:"client_credentials",scope:k}});case 4:n=e.sent,a=n.data,i=void 0===a?{}:a,localStorage.setItem("access_token",i.access_token),localStorage.setItem("expired_at",t+36e5),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log("GET TOKEN ERROR",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();function P(e){return A.apply(this,arguments)}function A(){return(A=Object(D.a)(S.a.mark((function e(t){var n,a,i,c,r,s,d;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query,a=void 0===n?"":n,i=t.variables,c=void 0===i?{}:i,r=localStorage.getItem("access_token"),s=localStorage.getItem("expired_at"),r&&s&&!(Date.now()>new Date(Number(s)))){e.next=8;break}return e.next=6,w();case 6:r=localStorage.getItem("access_token"),s=localStorage.getItem("expired_at");case 8:return e.prev=8,e.next=11,E()({method:"post",url:C,headers:{"X-Api-Key":R,Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},data:JSON.stringify({query:a,variables:c})});case 11:return d=e.sent,e.abrupt("return",d.data);case 15:e.prev=15,e.t0=e.catch(8),console.log("CALL API ERROR",e.t0);case 18:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}var L=function(){var e=Object(D.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"query\n    getSensorsWithIoT(\n        $model: Int,\n    ) {\n        getSensorsWithIoT(\n            model: $model,\n        ) {\n            deviceId\n            name\n            serial\n            mac\n            region\n            longitude\n            latitude\n            floor\n            distance\n            remark\n            optional\n            active\n            date\n            live\n            battery\n            humidity\n            temperature\n            height\n            maxHeight\n            x\n            y\n            z\n            tags\n            deploymentDate\n            compositionData\n            unicastAddr\n            meshStatus\n            status\n            error\n            lockStatus\n            network\n            frequency\n            server\n        }\n    }",e.next=3,P({query:"query\n    getSensorsWithIoT(\n        $model: Int,\n    ) {\n        getSensorsWithIoT(\n            model: $model,\n        ) {\n            deviceId\n            name\n            serial\n            mac\n            region\n            longitude\n            latitude\n            floor\n            distance\n            remark\n            optional\n            active\n            date\n            live\n            battery\n            humidity\n            temperature\n            height\n            maxHeight\n            x\n            y\n            z\n            tags\n            deploymentDate\n            compositionData\n            unicastAddr\n            meshStatus\n            status\n            error\n            lockStatus\n            network\n            frequency\n            server\n        }\n    }",variables:t});case 3:return n=e.sent,e.abrupt("return",I.a.get(n,"data.getSensorsWithIoT"));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(D.a)(S.a.mark((function e(t){var n,a,i,c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.deviceId,a=t.name,i=t.serial,"mutation\n    updateDevice(\n          $input: DeviceUpdateInput,\n    ) {\n        updateDevice(\n            input: $input,\n        ) {\n            deviceId\n            name\n            serial\n        }\n    }",e.next=4,P({query:"mutation\n    updateDevice(\n          $input: DeviceUpdateInput,\n    ) {\n        updateDevice(\n            input: $input,\n        ) {\n            deviceId\n            name\n            serial\n        }\n    }",variables:{input:{deviceId:n,name:a,serial:i}}});case 4:if(c=e.sent,!I.a.get(c,"data.updateDevice")){e.next=7;break}return e.abrupt("return",I.a.get(c,"data.updateDevice"));case 7:throw Error(I.a.get(c,"errors[0].message"));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(D.a)(S.a.mark((function e(){var t,n,a,i=arguments;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:[],n="mutation\n      deleteDevices(\n        $type: String, $deviceIds: [Int]\n      ) {\n          deleteDevices(\n              type: $type,\n              deviceIds: $deviceIds\n          ) {\n            rows_deleted\n          }\n      }",e.next=4,P({query:n,variables:{type:"",deviceIds:t}});case 4:if(a=e.sent,!I.a.get(a,"data.deleteDevices")){e.next=7;break}return e.abrupt("return",I.a.get(a,"data.deleteDevices.rows_deleted"));case 7:throw Error(I.a.get(a,"errors[0].message"));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=n(125),F=n(114),H=n(115),q=n(116),$=n(117),z=n(54),B=n(118),M=n(119),Y=function(e){Object(j.a)(n,e);var t=Object(p.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props,t=e.isOpen,n=e.toggle,i=e.handleChangeInput,c=e.updatingDevice,r=e.handleUpdateDevice;return Object(a.jsxs)(W.a,{isOpen:t,toggle:function(){return n()},centered:!0,children:[Object(a.jsx)(F.a,{toggle:function(){return n()},children:"UPDATE DEVICE"}),Object(a.jsxs)(H.a,{children:[Object(a.jsxs)(q.a,{children:[Object(a.jsx)($.a,{addonType:"prepend",children:Object(a.jsx)(z.a,{children:"ID"})}),Object(a.jsx)(B.a,{type:"text",value:c.deviceId,disabled:!0})]}),Object(a.jsx)("br",{}),Object(a.jsxs)(q.a,{children:[Object(a.jsx)($.a,{addonType:"prepend",children:Object(a.jsx)(z.a,{children:"Label"})}),Object(a.jsx)(B.a,{name:"name",type:"text",value:c.name,onChange:i})]}),Object(a.jsx)("br",{}),Object(a.jsxs)(q.a,{children:[Object(a.jsx)($.a,{addonType:"prepend",children:Object(a.jsx)(z.a,{children:"Serial"})}),Object(a.jsx)(B.a,{name:"serial",type:"text",value:c.serial,onChange:i})]}),Object(a.jsx)("span",{className:"error-message",children:c.errorMessage}),Object(a.jsx)("br",{}),Object(a.jsxs)(q.a,{children:[Object(a.jsx)($.a,{addonType:"prepend",children:Object(a.jsx)(z.a,{children:"Region"})}),Object(a.jsx)(B.a,{type:"text",value:c.region,disabled:!0})]})]}),Object(a.jsxs)(M.a,{children:[Object(a.jsx)(v.a,{color:"primary",onClick:function(){return r()},disabled:c.isUpdating,children:c.isUpdating?"Updating...":"Update"}),Object(a.jsx)(v.a,{color:"secondary",onClick:function(){return n()},disabled:c.isUpdating,children:"Cancel"})]})]})}}]),n}(c.a.Component),V=function(e){Object(j.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).toggleUpdateDeviceModal=function(e){a.setState({modal:e,updatingDevice:a.state.devices.find((function(t){return t.deviceId===e}))||{}})},a.handleChangeInput=function(e){a.setState({updatingDevice:Object(o.a)(Object(o.a)({},a.state.updatingDevice),{},Object(d.a)({},e.target.name,e.target.value))})},a.handleUpdateDevice=function(){a.setState({updatingDevice:Object(o.a)(Object(o.a)({},a.state.updatingDevice),{},{isUpdating:!0})}),K(a.state.updatingDevice).then((function(e){e?a.setState({loading:!1,modal:void 0,devices:a.state.devices.map((function(t){return t.deviceId!==a.state.updatingDevice.deviceId?t:Object(o.a)(Object(o.a)({},t),e)})),updateDevice:{}}):a.setState({loading:!1})})).catch((function(e){a.setState({updatingDevice:Object(o.a)(Object(o.a)({},a.state.updatingDevice),{},{isUpdating:!1,errorMessage:e.message})})}))},a.handleDeleteDevice=function(e){a.setState({loading:!0}),N([e]).then((function(t){t?a.setState({loading:!1,devices:a.state.devices.filter((function(t){return t.deviceId!==e}))}):a.setState({loading:!1})})).catch((function(e){a.setState({loading:!1})}))},a.state={loading:!1,devices:[],modal:void 0,updatingDevice:{}},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setState({loading:!0}),L({model:19}).then((function(t){e.setState({loading:!1,devices:t})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.modal,i=t.devices,c=t.updatingDevice,r=t.loading;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(h.a,{striped:!0,children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[Object(a.jsx)("th",{children:"#"}),Object(a.jsx)("th",{children:"ID"}),Object(a.jsx)("th",{children:"Label"}),Object(a.jsx)("th",{children:"Serial Code"}),Object(a.jsx)("th",{children:"Last Saved region"}),Object(a.jsx)("th",{children:"Live"}),Object(a.jsx)("th",{children:"Status"}),Object(a.jsx)("th",{children:"Created Since"}),Object(a.jsx)("th",{children:"Action"})]})}),Object(a.jsx)("tbody",{children:i.map((function(t,n){return Object(a.jsxs)("tr",{children:[Object(a.jsx)("th",{scope:"row",children:n+1}),Object(a.jsx)("td",{children:t.deviceId}),Object(a.jsx)("td",{children:t.name}),Object(a.jsx)("td",{children:t.serial}),Object(a.jsx)("td",{children:t.region}),Object(a.jsx)("td",{children:new Date(t.live).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"medium",hour12:!1})}),Object(a.jsx)("td",{children:t.status}),Object(a.jsx)("td",{children:new Date(t.date).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"medium",hour12:!1})}),Object(a.jsxs)("td",{children:[Object(a.jsx)(v.a,{color:"primary",onClick:function(){return e.toggleUpdateDeviceModal(t.deviceId)},children:Object(a.jsx)("i",{className:"fa fa-edit"})}),Object(a.jsx)(v.a,{color:"danger",id:"PopoverFocus-".concat(t.deviceId),children:Object(a.jsx)("i",{className:"fa fa-trash"})}),Object(a.jsxs)(b.a,{trigger:"focus",placement:"bottom",target:"PopoverFocus-".concat(t.deviceId),children:[Object(a.jsx)(O.a,{children:"Delete device comfirmation"}),Object(a.jsxs)(g.a,{children:["Would you like to delete this device!",Object(a.jsx)(v.a,{size:"sm",color:"warning",onClick:function(){return e.handleDeleteDevice(t.deviceId)},children:"Confirm"})]})]})]})]},t.deviceId)}))})]}),Object(a.jsx)(Y,{isOpen:!!n,toggle:this.toggleUpdateDeviceModal,handleChangeInput:this.handleChangeInput,updatingDevice:c,handleUpdateDevice:this.handleUpdateDevice}),Object(a.jsx)(x,{loading:r})]})}}]),n}(c.a.Component);var X=function(){return Object(a.jsx)(V,{})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,126)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),c(e),r(e)}))};n(110);s.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(X,{})}),document.getElementById("root")),J()},62:function(e,t,n){}},[[111,1,2]]]);
//# sourceMappingURL=main.0817c310.chunk.js.map